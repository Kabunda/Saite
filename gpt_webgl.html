<!DOCTYPE html>
<html>
<head>
    <title>3D Горный ландшафт</title>
    <style> body { margin: 0; overflow: hidden; } </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/DeviceOrientationControls.js"></script>

    <script>
        let camera, scene, renderer, controls;

        function init() {
            // Scene setup
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // Lighting
            const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
            hemiLight.position.set(0, 100, 0);
            scene.add(hemiLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(-10, 15, -5);
            scene.add(dirLight);

            // Генерация гор с шумом
            const mountainGeometry = new THREE.PlaneGeometry(200, 200, 100, 100);
            const vertices = mountainGeometry.attributes.position.array;
            
            for(let i = 0; i < vertices.length; i += 3) {
                vertices[i + 2] = fractalNoise(vertices[i], vertices[i + 1]) * 35;
            }
            
            mountainGeometry.computeVertexNormals();

            // Материалы
            const rockTexture = new THREE.TextureLoader().load('https://threejs.org/examples/textures/terrain/rock.jpg');
            const snowTexture = new THREE.TextureLoader().load('https://threejs.org/examples/textures/snow.jpg');

            const mountainMaterial = new THREE.MeshPhongMaterial({
                map: rockTexture,
                normalMap: rockTexture,
                normalScale: new THREE.Vector2(0.3, 0.3)
            });

            const mountain = new THREE.Mesh(mountainGeometry, mountainMaterial);
            mountain.rotation.x = -Math.PI / 2;
            scene.add(mountain);

            // Снежное покрытие
            const snowGeometry = mountainGeometry.clone();
            const snowVertices = snowGeometry.attributes.position.array;
            
            for(let i = 0; i < snowVertices.length; i += 3) {
                if(snowVertices[i + 2] > 20) {
                    snowVertices[i + 2] += 1.5;
                }
            }

            const snowMaterial = new THREE.MeshPhongMaterial({
                map: snowTexture,
                transparent: true,
                opacity: 0.9
            });

            const snowLayer = new THREE.Mesh(snowGeometry, snowMaterial);
            snowLayer.rotation.x = -Math.PI / 2;
            scene.add(snowLayer);

            // Настройка камеры
            camera.position.set(0, 60, 80);
            controls = new THREE.DeviceOrientationControls(camera);

            // Анимация
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }

            // Адаптивность
            window.addEventListener('resize', onWindowResize, false);
            animate();
        }

        function fractalNoise(x, y) {
            let noise = 0;
            let frequency = 0.05;
            let amplitude = 1;
            
            for(let i = 0; i < 5; i++) {
                noise += Math.abs(perlin.get(x * frequency, y * frequency)) * amplitude;
                frequency *= 2;
                amplitude *= 0.5;
            }
            return noise;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Инициализация шума Перлина
        const perlin = new (class {
            constructor() {
                this.grad3 = [[1,1,0], [-1,1,0], [1,-1,0], [-1,-1,0], 
                            [1,0,1], [-1,0,1], [1,0,-1], [-1,0,-1], 
                            [0,1,1], [0,-1,1], [0,1,-1], [0,-1,-1]];
                this.p = new Uint8Array(256);
                this.perm = new Uint8Array(512);
                this.seed(0);
            }

            seed(seed) {
                let i, j, tmp;
                for(i = 0; i < 256; i++) this.p[i] = i;
                for(i = 0; i < 256; i++) {
                    j = (seed = (seed * 16807) % 2147483647) % (256 - i) + i;
                    tmp = this.p[i];
                    this.p[i] = this.p[j];
                    this.p[j] = tmp;
                    this.perm[i] = this.perm[i + 256] = this.p[i];
                }
            }

            get(x, y) {
                let X = Math.floor(x) & 255, Y = Math.floor(y) & 255;
                x -= Math.floor(x); y -= Math.floor(y);
                let u = x*x*x*(x*(x*6-15)+10);
                let v = y*y*y*(y*(y*6-15)+10);
                
                let a = this.perm[X] + Y;
                let b = this.perm[X + 1] + Y;
                
                return this.lerp(v, this.lerp(u, this.grad(this.perm[a], x, y, 0),
                        this.grad(this.perm[b], x-1, y, 0)),
                    this.lerp(u, this.grad(this.perm[a + 1], x, y-1, 0),
                        this.grad(this.perm[b + 1], x-1, y-1, 0)));
            }

            grad(hash, x, y, z) {
                let g = this.grad3[hash % 12];
                return g[0]*x + g[1]*y + g[2]*z;
            }

            lerp(t, a, b) { return a + t*(b - a); }
        })();

        init();
    </script>
</body>
</html>